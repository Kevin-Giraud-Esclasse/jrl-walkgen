user_all: user_targets 
include Makefile

USER_PLUGINS = 	$(IOSRVBIN)/WalkGenJRL.$(DLLSFX) 

USER_OBJS    = 	$(IOSRVBIN)/WalkGenJRL.$(OSFX) \
	     $(IOSRVBIN)/walkpluginJRL.$(OSFX)    

user_targets: make_stubskel $(USER_PLUGINS)

#PATTERNGENERATORJRLDIR=$(OPENHRPHOME)/PatternGeneratorJRL/trunk/PatternGeneratorJRL/
# changed PATTERNGENERATORJRLDIR
PATTERNGENERATORJRLDIR=$(SOURCE_DIR)/..

$(USER_PLUGINS):
	$(LINK) $(SOFLAGS) $(OUTOPT)$@ $^

# added -I$(OPENHRPHOME)/PatternGeneratorJRL/src
$(USER_OBJS):
	$(CXX) $(CFLAGS) -I$(OPENHRPHOME)/PatternGeneratorJRL/src -I../../robot/$(ROBOT) $< -o $@
make_stubskel:
	cd $(CONTROLLER)/$(CORBA_DIR);make

CXX_FLAGS+=-I$(PATTERNGENERATORJRLDIR)/include -I$(PATTERNGENERATORJRLDIR)/plugin/corba/OmniORB4/cpp $(OB_INCLUDE_DIR) @DYNAMICJRLJAP_CFLAGS@ @BOOST_CXXFLAGS@ @BOOST_SANDBOX_CXXFLAGS@
# add -L$(PATTERNGENERATORJRLDIR)/src
LINK_FLAGS+=-L$(PATTERNGENERATORJRLDIR)/lib -L@abs_builddir@/../src/.libs -lwalkGenJRL @DYNAMICJRLJAP_LIBS@ @LDFLAGS@ -L$(OB_LIB_DIR) $(OB_LIBS) -lpthread -lstdc++ -lg2c #-lf2c


COMMON_TARGET_H= plugin.h $(CONTROLLER)/$(CORBA_DIR)/common.h
$(IOSRVBIN)/WalkGenJRL.$(DLLSFX): $(IOSRVBIN)/WalkGenJRL.$(OSFX) $(IOSRVBIN)/walkpluginJRL.$(OSFX) seqplugin.$(OSFX) dynamicsPlugin.$(OSFX)  
#$(IOSRVBIN)/libWalkGenJRL.$(DLLSFX): $(IOSRVBIN)/WalkGenJRL.$(OSFX) seqplugin.$(OSFX) dynamicsPlugin.$(OSFX) 

$(IOSRVBIN)/WalkGenJRL.$(OSFX): $(SOURCE_DIR)/WalkGenJRL.cpp $(COMMON_TARGET_H) seqplugin.h dynamicsPlugin.h
$(IOSRVBIN)/walkpluginJRL.$(OSFX): $(SOURCE_DIR)/corba/OmniORB4/cpp/walkpluginJRL.cpp common.h 

user_clean:
	rm -f $(USER_PLUGINS) $(USER_OBJS)
	rm -f common.h 
	rm -f $(PATTERNGENERATORJRLDIR)/plugin/*~

# modify: the *.py files located at $(SOURCE_DIR)/plugin/script
#        Walk -> WalkGen
#$(IOSRVBIN)/script/TestWalkGenJRLIntegrateExperiment2.py: $(SOURCE_DIR)/script/TestWalkGenJRLIntegrateExperiment2.py
#	cp -f $(SOURCE_DIR)/script/TestWalkGenJRLIntegrateExperiment2.py $(IOSRVBIN)/script
#	cp $(SOURCE_DIR)/script/TestWalkGenJRLIntegrateExperiment2.py $(IOSRVBIN)/script/TestWalkGenJRLIntegrateExperiment2.py
#$(IOSRVBIN)/script/TestWalkGenPBW.py: $(SOURCE_DIR)/script/TestWalkGenPBW.py
#	cp -f $(SOURCE_DIR)/script/TestWalkGenPBW.py $(IOSRVBIN)/script

$(IOSRVBIN)/libWalkGen.so: $(BUILD_DIR)/../src/libWalkGenJRL.so
	cp -f $(BUILD_DIR)/../src/libWalkGenJRL.so $(IOSRVBIN)


user_install: 
	if [test -s $(OPENHRPHOME)/Make.rules]; then \
	cd @abs_builddir@/corba; $(MAKE) install \
	fi
